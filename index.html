<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Encuesta – Estudio Quineche</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(180deg, #e6e1f8, #f5f4fb);
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 750px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, .1);
      overflow: hidden;
    }

    .hidden {
      display: none;
    }


    .header {
      display: flex;
      align-items: center;
      padding: 15px 25px;
      background-color: #fff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .05);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header img {
      height: 60px;
      width: auto;
      max-width: 180px;
    }

    .content {
      padding: 40px 30px;
      animation: fadeIn .6s ease-in-out;
    }

    @media(max-width:480px) {
      .content {
        padding: 20px 10px;
      }

      .header {
        justify-content: center;
      }

      .header img {
        height: 45px;
        max-width: 140px;
      }
    }

    h2 {
      text-align: center;
      color: #2e2b57;
      margin-top: 10px;
      font-size: 26px;
    }

    label {
      display: block;
      color: #333;
      margin: 18px 0 8px;
    }

    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
      resize: vertical;
      box-sizing: border-box;
    }

    textarea:focus {
      outline: none;
      border-color: #6b5cff;
      box-shadow: 0 0 0 3px rgba(75, 61, 245, .2);
    }

    button {
      display: block;
      width: 100%;
      background: #4b3df5;
      color: #fff;
      border: none;
      padding: 14px;
      font-size: 17px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 25px;
      font-weight: 600;
      transition: all .3s;
    }

    button:hover {
      background: #372fd4;
      transform: scale(1.02);
    }

    .footer {
      text-align: center;
      padding: 20px;
      color: #777;
      font-size: 14px;
    }

    .section {
      border: 1px solid #e5e5e5;
      border-left: 6px solid #4b3df5;
      border-radius: 10px;
      padding: 25px 20px;
      margin-top: 25px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, .05);
    }

    .rating-options0-10 {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 6px;
      width: 100%;
    }

    .rating-options {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
      width: 100%;
    }

    .rating-option input {
      display: none;
    }

    .rating-option span {
      display: inline-block;
      width: 100%;
      text-align: center;
      padding: 10px 0;
      background: #fff;
      border: 1.5px solid #ccc;
      border-radius: 6px;
      color: #333;
      cursor: pointer;
      transition: all .2s ease;
    }

    .rating-option span:hover {
      border-color: #6b5cff;
      background: #f0edff;
    }

    .rating-option input:checked+span {
      background: #4b3df5;
      color: #fff;
      border-color: #4b3df5;
      font-weight: 600;
      box-shadow: 0 0 6px rgba(75, 61, 245, .4);
    }

    .error {
      border-color: red !important;
      box-shadow: 0 0 4px red !important;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <img src="logo.png" alt="Estudio Quineche">
    </header>

    <div class="content">
      <h2>Encuesta de Satisfacción</h2>

      <div id="loading" class="hidden" style="text-align:center;padding:60px 20px;">
        <div style="font-size:1.3rem;color:#4b3df5;font-weight:600;margin-bottom:20px;">⏳ Enviando tus respuestas...
        </div>
        <div class="spinner"
          style="border:5px solid #eee;border-top:5px solid #4b3df5;border-radius:50%;width:70px;height:70px;margin:0 auto;animation:spin 1s linear infinite;">
        </div>
      </div>

      
      <div id="intro">
        <p><strong>Estimado(a) <span id="nombre"></span>:</strong></p>
        <p>
          Nos es muy grato saludarte en este día. En Estudio Quineche estamos comprometidos con brindar un servicio
          excepcional a nuestros clientes; nuestro equipo se esfuerza constantemente por superar las expectativas y
          garantizar que cada interacción con ustedes sea satisfactoria.
        </p>
        <p>
          Nos gustaría conocer tu percepción sobre los servicios de asesoría y acompañamiento que venimos realizando con
          su empresa hasta el momento.
        </p>
        <p>
          Por ello, le invitamos a responder esta breve encuesta con el fin de mejorar y ofrecerles un servicio de
          calidad.
        </p>

      </div>
      <form id="form">
        <!-- SECCIÓN 1 -->
        <div id="sec1" class="section">
          <label style="font-weight: 600;">
            En una escala de 0 al 10, donde 0 es “Definitivamente NO lo recomendaría”, y 10 es “Definitivamente SI lo
            recomendaría”. ¿Qué tan probable es que recomiende al Estudio Quineche a otra empresa?.
          </label>
          <div class="rating-options0-10" id="recomendacionOptions"></div>
          <div id="recPreg0_6" class="hidden">
            <label>
              Si tu calificación fue 0 - 6, ¿Qué aspectos no te agradan para calificarlo así? (indispensable)
            </label>
            <textarea name="comentario_0_6" rows="3"></textarea>
          </div>
          <div id="recPreg7_8" class="hidden">
            <label>
              Si tu calificación fue 7 - 8, ¿Qué aspectos consideras que debe mejorar el Estudio Quineche para que lo puedas recomendar más? (indispensable)
            </label>
            <textarea name="comentario_7_8" rows="3"></textarea>
          </div>
          <div id="recPreg9_10" class="hidden">
            <label>
              Si tu calificación fue 9 o 10, ¿Qué aspectos resaltan para que recomiendes al Estudio Quineche? (indispensable)
            </label>
            <textarea name="comentario_9_10" rows="3"></textarea>
          </div>
        </div>


        <p>
          Califica los siguientes aspectos relacionados con el servicio “legal o contable” que ofrece en Estudio
          Quineche, siendo 1 “muy insatisfecho”, y 10 “Totalmente satisfecho”.
        </p>


        <!-- SECCIÓN 2 -->
        <div id="sec2" class="section">
          <label style="font-weight: 600;">
            Respecto al cumplimiento de los TRABAJOS y AVANCES ENTREGABLES según el servicio pactado.
          </label>

          <div class="rating-options" id="trabajosOptions"></div>

          <div id="coment_trabajos">
            <label>
              Coméntenos por qué calificó así. (indispensable)
            </label>
            <textarea name="coment_trabajos" rows="3" required></textarea>
          </div>

        </div>


        <!-- SECCIÓN 3 -->
        <div id="sec3" class="section">
          <label style="font-weight: 600;">
            ¿Los entregables (trabajos y avances pactados) cumplen con sus expectativas?.
          </label>

          <div class="rating-options" id="cumplimientoOptions"></div>

          <div id="coment_cumplimiento">
            <label>
              Coméntenos por qué calificó así. (indispensable)
            </label>
            <textarea name="coment_cumplimiento" rows="3" required></textarea>
          </div>

        </div>


        <!-- SECCIÓN 4 -->
        <div id="sec4" class="section" adas>
          <label style="font-weight: 600;">
            Respecto a la gestión y conocimiento de nuestro personal en el ASESORAMIENTO del servicio pactado
          </label>

          <div class="rating-options" id="asesoramientoOptions"></div>

          <div id="coment_asesoramiento">
            <label>
              Coméntenos por qué calificó así. (indispensable)
            </label>
            <textarea name="coment_asesoramiento" rows="3" required></textarea>
          </div>

        </div>


        <!-- SECCIÓN 5 -->
        <div id="sec5" class="section">
          <label style="font-weight: 600;">
            Respecto al TIEMPO DE RESPUESTA de nuestro personal ante cualquier requerimiento
          </label>

          <div class="rating-options" id="tiempoOptions"></div>

          <div id="coment_tiempo">
            <label>
              Coméntenos por qué calificó así. (indispensable)
            </label>
            <textarea name="coment_tiempo" rows="3" required></textarea>
          </div>

        </div>


        <!-- SECCIÓN 6 -->
        <div id="sec6" class="section">
          <label style="font-weight: 600;">
            Respecto a la AMABILIDAD Y DISPOSICIÓN de nuestro personal.
          </label>

          <div class="rating-options" id="amabilidadOptions"></div>

          <div id="coment_amabilidad">
            <label>
              Coméntenos por qué calificó así. (indispensable)
            </label>
            <textarea name="coment_amabilidad" rows="3" required></textarea>
          </div>
        </div>

        <!-- SECCIÓN 7 -->
        <div id="sec7" class="section">
          <label>
            ¿Qué nuevos u otros servicios te gustaría que ofrezca el Estudio Quineche? (indispensable)
          </label>

          <div id="coment_servicios">
            <textarea name="coment_servicios" rows="3" required></textarea>
          </div>

        </div>


        <button type="submit">Enviar respuestas</button>
      </form>

      <p id="msg" style="text-align:center;"></p>
    </div>

    <div class="footer">© 2025 Estudio Quineche | Todos los derechos reservados</div>
  </div>

  <script>

    // Mostrar nombre
    const params = new URLSearchParams(window.location.search);
    document.getElementById('nombre').innerText = params.get('nombre') || 'cliente';

  

    // Lista de ids para los grupos de botones de calificación
    const optionsIds = [
      "recomendacionOptions",
      "trabajosOptions",
      "cumplimientoOptions",
      "asesoramientoOptions",
      "tiempoOptions",
      "amabilidadOptions",
      "calidadOptions"
    ];

    // Generar botones de calificación
    optionsIds.forEach(id => {
      const c = document.getElementById(id);
      if (c) {
        const rangeStart = id === "recomendacionOptions" ? 0 : 1;
        const rangeEnd = 10;

        c.innerHTML = Array.from({ length: rangeEnd - rangeStart + 1 }, (_, i) => {
          const value = i + rangeStart;
          return `
        <label class='rating-option'>
          <input type='radio' name='${id}' value='${value}'>
          <span>${value}</span>
        </label>
      `;
        }).join('');
      }
    });

       // Sección 1: mostrar textarea según rango
    document.querySelectorAll('#recomendacionOptions input').forEach(r => {
      r.addEventListener('change', e => {
        const val = parseInt(e.target.value);
        const p0_6 = document.getElementById('recPreg0_6'),
          p7_8 = document.getElementById('recPreg7_8'),
          p9_10 = document.getElementById('recPreg9_10');
        [p0_6, p7_8, p9_10].forEach(p => p.classList.add('hidden'));
        const active = val <= 6 ? p0_6 : val <= 8 ? p7_8 : p9_10;
        active.classList.remove('hidden');
        const t = active.querySelector('textarea');
        t.addEventListener('input', () => { if (t.value.trim().length > 3) document.getElementById('btn1').classList.remove('hidden'); });
      });
    });


document.getElementById("form").addEventListener("submit", async e => {
  e.preventDefault();

  console.log("🚀 Evento submit detectado");

  const form = e.target;
  const intro = document.getElementById('intro');
  const loading = document.getElementById('loading');
  const msg = document.getElementById('msg');

  const grupos = [
    "recomendacionOptions",
    "trabajosOptions",
    "cumplimientoOptions",
    "asesoramientoOptions",
    "tiempoOptions",
    "amabilidadOptions"
  ];
  const faltantes = [];

  console.log("🧩 Iniciando validación de radios...");

  grupos.forEach(nombre => {
    const seleccion = form.querySelector(`input[name='${nombre}']:checked`);
    if (!seleccion) {
      faltantes.push(nombre);
      console.warn(`⚠️ Falta seleccionar: ${nombre}`);
    } else {
      console.log(`✅ ${nombre}: ${seleccion.value}`);
    }
  });

  console.log("🧾 Validando textareas...");

  const recomendacion = form.querySelector("input[name='recomendacionOptions']:checked");
  let requerido = null;
  if (recomendacion) {
    const val = parseInt(recomendacion.value);
    if (val <= 6) requerido = "comentario_0_6";
    else if (val <= 8) requerido = "comentario_7_8";
    else requerido = "comentario_9_10";
    console.log(`🧠 Solo se requiere llenar: ${requerido}`);
  }

  const textareas = Array.from(form.querySelectorAll("textarea"));
  const vacios = textareas.filter(t => {
    const esVisible = !t.closest(".hidden");
    const esRequerido = t.name === requerido;
    return (esVisible || esRequerido) && t.value.trim().length < 3;
  });
  vacios.forEach(v => console.warn(`⚠️ Textarea vacío: ${v.name}`));

  if (faltantes.length > 0 || vacios.length > 0) {
    console.log("❌ Faltan campos por completar");
    const primero = faltantes.length
      ? document.getElementById(faltantes[0])
      : vacios[0];
    primero.scrollIntoView({ behavior: "smooth", block: "center" });
    primero.classList.add("error");
    setTimeout(() => primero.classList.remove("error"), 2000);
    alert("⚠️ Por favor completa todas las preguntas antes de enviar.");
    return;
  }

  console.log("✅ Todos los campos completos. Enviando datos...");

  // 🔹 Animación (solo oculta #intro y muestra el spinner)
  intro.style.animation = 'fadeOut .5s forwards';
  setTimeout(() => {
    intro.classList.add('hidden');
    loading.classList.remove('hidden');
    loading.style.animation = 'fadeIn .5s';
  }, 400);

  // 🔹 Enviar datos
  const data = {};
  new FormData(form).forEach((v, k) => (data[k] = v));
  console.log("📦 Datos recopilados:", data);

  const url = "https://n8n.estudioquineche.com/webhook-test/94d5ddbf-b78d-4c54-9d6c-52ca809e3def";

  try {
    const response = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    console.log("📡 Respuesta recibida:", result);

    loading.style.animation = 'fadeOut .6s forwards';
    setTimeout(() => {
      loading.classList.add('hidden');
      msg.innerHTML = `
        <div style="text-align:center;animation:fadeIn 1s;">
          <h3>¡Gracias por su participación!</h3>
          <p>Sus respuestas fueron registradas correctamente.<br>Su opinión es muy valiosa y nos ayuda a mejorar continuamente.</p>
          <p><strong>Atentamente,<br>El equipo de Estudio Quineche</strong></p>
        </div>`;
    }, 500);
  } catch (err) {
    console.error("💥 Error en el envío:", err);
    loading.classList.add('hidden');
    msg.innerHTML = `<p style="color:red;text-align:center;">❌ Error: ${err.message}</p>`;
    intro.classList.remove('hidden');
  }
});


  </script>
</body>

</html>
